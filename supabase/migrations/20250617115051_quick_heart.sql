/*
  # Email Authentication Setup

  1. Email Templates
    - Create custom HTML email templates for confirmation and password reset
    - Configure email settings for better user experience

  2. Auth Configuration
    - Enable email confirmation
    - Set up custom email templates
    - Configure redirect URLs
*/

-- Enable email confirmation (this will be configured in Supabase dashboard)
-- But we can set up the email templates here

-- Create a function to send custom emails (this is a placeholder - actual email sending is handled by Supabase Auth)
CREATE OR REPLACE FUNCTION public.get_custom_email_template(template_type text)
RETURNS text AS $$
BEGIN
  CASE template_type
    WHEN 'confirmation' THEN
      RETURN '
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ - –°—Ç—Ä–æ–π–ú–æ–Ω–∏—Ç–æ—Ä</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 0; background-color: #f8fafc; }
        .container { max-width: 600px; margin: 0 auto; background-color: white; }
        .header { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); padding: 40px 20px; text-align: center; }
        .logo { color: white; font-size: 28px; font-weight: bold; margin-bottom: 8px; }
        .subtitle { color: #bfdbfe; font-size: 16px; }
        .content { padding: 40px 20px; }
        .title { font-size: 24px; font-weight: bold; color: #1e293b; margin-bottom: 16px; }
        .text { color: #64748b; line-height: 1.6; margin-bottom: 24px; }
        .button { display: inline-block; background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; text-decoration: none; padding: 16px 32px; border-radius: 8px; font-weight: 600; margin: 20px 0; }
        .footer { background-color: #f1f5f9; padding: 20px; text-align: center; color: #64748b; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üèóÔ∏è –°—Ç—Ä–æ–π–ú–æ–Ω–∏—Ç–æ—Ä</div>
            <div class="subtitle">–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞—Ç—Ä–∞—Ç —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
        </div>
        <div class="content">
            <h1 class="title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –°—Ç—Ä–æ–π–ú–æ–Ω–∏—Ç–æ—Ä!</h1>
            <p class="text">
                –°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞—Ç—Ä–∞—Ç —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. 
                –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤–∞—à email-–∞–¥—Ä–µ—Å.
            </p>
            <p class="text">
                –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç:
            </p>
            <a href="{{ .ConfirmationURL }}" class="button">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å email</a>
            <p class="text">
                –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ –≤–∞—à –±—Ä–∞—É–∑–µ—Ä:<br>
                <a href="{{ .ConfirmationURL }}">{{ .ConfirmationURL }}</a>
            </p>
            <p class="text">
                –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã —Å–º–æ–∂–µ—Ç–µ:
            </p>
            <ul style="color: #64748b; line-height: 1.6;">
                <li>–°–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏</li>
                <li>–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</li>
                <li>–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –±—é–¥–∂–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</li>
                <li>–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–µ–∫—Ç–æ–≤</li>
            </ul>
        </div>
        <div class="footer">
            <p>–ï—Å–ª–∏ –≤—ã –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ –°—Ç—Ä–æ–π–ú–æ–Ω–∏—Ç–æ—Ä, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ —ç—Ç–æ –ø–∏—Å—å–º–æ.</p>
            <p>¬© 2024 –°—Ç—Ä–æ–π–ú–æ–Ω–∏—Ç–æ—Ä. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </div>
</body>
</html>';
    WHEN 'recovery' THEN
      RETURN '
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è - –°—Ç—Ä–æ–π–ú–æ–Ω–∏—Ç–æ—Ä</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 0; background-color: #f8fafc; }
        .container { max-width: 600px; margin: 0 auto; background-color: white; }
        .header { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); padding: 40px 20px; text-align: center; }
        .logo { color: white; font-size: 28px; font-weight: bold; margin-bottom: 8px; }
        .subtitle { color: #fecaca; font-size: 16px; }
        .content { padding: 40px 20px; }
        .title { font-size: 24px; font-weight: bold; color: #1e293b; margin-bottom: 16px; }
        .text { color: #64748b; line-height: 1.6; margin-bottom: 24px; }
        .button { display: inline-block; background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; text-decoration: none; padding: 16px 32px; border-radius: 8px; font-weight: 600; margin: 20px 0; }
        .footer { background-color: #f1f5f9; padding: 20px; text-align: center; color: #64748b; font-size: 14px; }
        .warning { background-color: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 16px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üèóÔ∏è –°—Ç—Ä–æ–π–ú–æ–Ω–∏—Ç–æ—Ä</div>
            <div class="subtitle">–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞—Ç—Ä–∞—Ç —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
        </div>
        <div class="content">
            <h1 class="title">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</h1>
            <p class="text">
                –ú—ã –ø–æ–ª—É—á–∏–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –¥–ª—è –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –°—Ç—Ä–æ–π–ú–æ–Ω–∏—Ç–æ—Ä.
            </p>
            <p class="text">
                –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:
            </p>
            <a href="{{ .ConfirmationURL }}" class="button">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å</a>
            <p class="text">
                –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ –≤–∞—à –±—Ä–∞—É–∑–µ—Ä:<br>
                <a href="{{ .ConfirmationURL }}">{{ .ConfirmationURL }}</a>
            </p>
            <div class="warning">
                <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –≠—Ç–∞ —Å—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 1 —á–∞—Å–∞. 
                –ï—Å–ª–∏ –≤—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ —ç—Ç–æ –ø–∏—Å—å–º–æ.
            </div>
        </div>
        <div class="footer">
            <p>–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞—à–µ–π —Å–ª—É–∂–±–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏.</p>
            <p>¬© 2024 –°—Ç—Ä–æ–π–ú–æ–Ω–∏—Ç–æ—Ä. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </div>
</body>
</html>';
    ELSE
      RETURN 'Default email template';
  END CASE;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;